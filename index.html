<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Breaker | LunaSoul</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÉ</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: { colors: { sage: { 50: '#f4f7f4', 100: '#E8EDE6', 500: '#8A9A5B', 600: '#738249', 700: '#5F6F46', 900: '#2f3823' }, sand: '#F5F5F0' } }
            }
        }
    </script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #F5F5F0; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #2f3823; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; font-size: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 0; transition: opacity 0.5s, bottom 0.5s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        .progress-fill { transition: width 0.5s ease-in-out; }

        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #8A9A5B; cursor: pointer; margin-top: -8px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #E8EDE6; border-radius: 2px; }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col mx-auto max-w-md bg-sand transition-colors duration-300">

    <nav class="w-full bg-sage-500 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('screen-home')">
            <h1 class="font-semibold text-lg tracking-wide">Pattern Breaker</h1>
        </div>
        <div class="flex gap-3">
             <button id="upgradeBtn" onclick="showPaywall()" class="bg-white text-sage-700 px-3 py-1 rounded text-xs font-bold shadow hidden">Upgrade</button>
        </div>
    </nav>

    <main id="app-container" class="flex-grow p-4 pb-20 relative">

        <div id="progress-container" class="w-full h-1.5 bg-gray-200 rounded-full mb-6 mt-2 hidden">
            <div id="progress-fill" class="h-1.5 bg-sage-500 rounded-full w-0 progress-fill"></div>
        </div>

        <div id="screen-home" class="fade-in">
            <div class="text-center mt-8 mb-8">
                <div class="w-24 h-24 bg-sage-100 rounded-full flex items-center justify-center mx-auto mb-6 text-5xl shadow-inner">üçÉ</div>
                <h2 class="text-3xl font-bold text-sage-700">Welcome to Pattern Breaker</h2>
                <p class="text-gray-600 mt-4 text-sm leading-relaxed px-4">
                    Your pocket companion to decode abandonment triggers and regulate your nervous system.
                </p>
            </div>
            
            <button onclick="navigateTo('screen-safety')" class="w-full bg-sage-500 hover:bg-sage-600 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-105 mb-4">
                Decode My Pattern
            </button>

            <a href="https://angel-s-site-4148.thinkific.com/courses/understanding-relationship-patterns" target="_blank" class="block w-full bg-white border border-sage-200 text-sage-700 font-bold py-3 rounded-xl shadow-sm text-center text-sm mb-6 hover:bg-sage-50 transition">
                Take the Full Course
            </a>

            <p class="text-center text-xs text-gray-400 mt-2">Step 1 of 3</p>
            
            <div class="mt-6 grid grid-cols-2 gap-3">
                <button onclick="navigateTo('screen-vault')" class="bg-white p-3 rounded-lg shadow text-sm font-semibold text-gray-700"><i class="fas fa-book mr-2"></i>Vault</button>
                <button onclick="navigateTo('screen-about')" class="bg-white p-3 rounded-lg shadow text-sm font-semibold text-gray-700"><i class="fas fa-info-circle mr-2"></i>About</button>
            </div>
        </div>

        <div id="screen-safety" class="hidden fade-in pt-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-sage-500">
                <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-heart text-sage-500 mr-2"></i>Emotional Safety</h2>
                <p class="text-sm text-gray-600 leading-relaxed mb-4">
                    This is a self-guided tool. It is not a substitute for therapy. Some prompts may bring up strong emotions ‚Äî please pause if you need to.
                </p>
                <div class="bg-sage-50 p-3 rounded-lg mb-6">
                    <h3 class="text-xs font-bold text-sage-700 uppercase mb-1"><i class="fas fa-lock mr-1"></i> Privacy Notice</h3>
                    <p class="text-xs text-gray-600">Your journal entries and data are stored <strong>only on this device</strong>. We do not see, save, or track your personal reflections.</p>
                </div>
                <button onclick="navigateTo('screen-intake')" class="w-full bg-sage-500 hover:bg-sage-600 text-white font-bold py-3 rounded-lg">I Understand & Proceed</button>
                <p class="text-center text-xs text-gray-400 mt-4">Step 2 of 3</p>
            </div>
        </div>

        <div id="screen-intake" class="hidden fade-in">
            <h2 class="text-xl font-bold text-sage-700 mb-6">Check-In</h2>
            
            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">What's happening? (Vent here)</label>
                <textarea id="intake-vent" oninput="updateState('ventText', this.value)" rows="3" class="w-full p-4 bg-white border border-sage-200 rounded-xl text-base focus:ring-2 focus:ring-sage-500 outline-none shadow-sm" placeholder="I'm spiraling because..."></textarea>
            </div>

            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">1. What do you need?</label>
                <select id="intake-goal" onchange="updateState('supportArea', this.value)" class="w-full p-4 bg-white border border-sage-200 rounded-xl text-sm outline-none shadow-sm">
                    <option value="" disabled selected>Select an area...</option>
                    <option value="Clarity">Clarity</option>
                    <option value="Grounding">Grounding</option>
                    <option value="Release">Emotional Release</option>
                    <option value="Rewiring">Rewiring</option>
                    <option value="Guidance">Guidance</option>
                </select>
            </div>
            <div class="mb-8">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">2. Intensity (1-10)</label>
                <div class="bg-white p-4 rounded-xl border border-sage-200">
                    <input type="range" min="1" max="10" value="5" oninput="document.getElementById('intensity-val').innerText = this.value; updateState('intensity', this.value)">
                    <p class="text-center font-bold text-sage-600 mt-2 text-lg">Level: <span id="intensity-val">5</span></p>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">3. What behavior shows up first?</label>
                <select id="behavior-select" onchange="updateState('firstBehavior', this.value)" class="w-full p-4 bg-white border border-sage-200 rounded-xl text-sm outline-none shadow-sm">
                    <option value="" disabled selected>Select behavior...</option>
                    <option value="hyper_independence">Pulling away / Isolating</option>
                    <option value="panic_clinging">Clinging / Panic texting</option>
                    <option value="shutdown">Emotional shutdown / Numbness</option>
                    <option value="over_giving">Over giving (to avoid rejection)</option>
                    <option value="over_explaining">Over explaining (to feel safe)</option>
                    <option value="distrust">Checking / Scanning for danger</option>
                    <option value="self_blame">Self-blame / "I'm too much"</option>
                </select>
            </div>
            <button onclick="runDecoder()" class="w-full bg-sage-500 hover:bg-sage-600 text-white font-bold py-4 rounded-xl shadow-lg mt-4 flex justify-center items-center gap-2">
                <span id="decode-btn-text">Decode My Pattern</span>
                <i id="decode-spinner" class="fas fa-spinner fa-spin hidden"></i>
            </button>
            <p class="text-center text-xs text-gray-400 mt-4">Step 3 of 3</p>
        </div>

        <div id="screen-report" class="hidden fade-in pb-10">
            <div class="bg-sage-100 p-6 rounded-xl mb-6 border-l-4 border-sage-500 shadow-sm relative">
                <p class="text-xs uppercase tracking-widest text-gray-500 mb-1">Detected Pattern</p>
                <h2 id="out-pattern" class="text-2xl font-bold text-sage-800 mb-2">...</h2>
                <p id="out-subtype" class="text-sm font-semibold text-sage-600">...</p>
            </div>

            <div class="bg-sage-600 p-5 rounded-xl shadow-lg mb-6 text-white text-center">
                <h3 class="font-bold text-lg mb-1">Go Deeper</h3>
                <p class="text-sm opacity-90 mb-3">You've identified the pattern. Now learn how to heal the root cause permanently.</p>
                <a href="https://angel-s-site-4148.thinkific.com/courses/understanding-relationship-patterns" target="_blank" class="inline-block bg-white text-sage-700 font-bold px-6 py-2 rounded-lg text-sm hover:bg-gray-100 transition">
                    View Course Modules
                </a>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm mb-6">
                <h3 class="font-bold text-gray-800 text-sm mb-2 uppercase border-b pb-2">What's Happening</h3>
                <p id="out-what" class="text-sm text-gray-600 leading-relaxed mb-4">...</p>
                <h3 class="font-bold text-gray-800 text-sm mb-2 uppercase border-b pb-2">Why It Activates</h3>
                <p id="out-why" class="text-sm text-gray-600 leading-relaxed">...</p>
            </div>

            <div class="grid grid-cols-1 gap-4 mb-6">
                <button onclick="showModule('Pattern Interrupter')" class="flex items-center justify-between p-4 bg-sage-500 text-white rounded-xl shadow-lg hover:bg-sage-600 transition">
                    <span class="font-bold"><i class="fas fa-bolt mr-2"></i>Pattern Interrupter</span><i class="fas fa-chevron-right"></i>
                </button>
                <button onclick="showModule('Daily Practice')" class="flex items-center justify-between p-4 bg-white border border-sage-200 text-gray-700 rounded-xl shadow-sm hover:bg-sage-50 transition">
                    <span class="font-bold"><i class="fas fa-leaf mr-2 text-sage-500"></i>Daily Practice</span><i class="fas fa-chevron-right text-gray-400"></i>
                </button>
                <button onclick="showModule('Anchor for Today')" class="flex items-center justify-between p-4 bg-white border border-sage-200 text-gray-700 rounded-xl shadow-sm hover:bg-sage-50 transition">
                    <span class="font-bold"><i class="fas fa-anchor mr-2 text-sage-500"></i>Anchor for Today</span><i class="fas fa-chevron-right text-gray-400"></i>
                </button>
                <button onclick="showModule('Journal Prompt')" class="flex items-center justify-between p-4 bg-white border border-sage-200 text-gray-700 rounded-xl shadow-sm hover:bg-sage-50 transition">
                    <span class="font-bold"><i class="fas fa-pen mr-2 text-sage-500"></i>Journal Prompt</span><i class="fas fa-chevron-right text-gray-400"></i>
                </button>
            </div>
            <button onclick="saveResultToVault()" class="w-full text-center text-sage-600 text-sm font-bold mb-4">Save Result to Vault</button>
            <button onclick="resetFlow()" class="w-full text-center text-gray-400 text-sm">Start Next Decode</button>
        </div>

        <div id="screen-module" class="hidden fade-in pt-6">
            <h2 id="mod-title" class="text-xl font-bold text-sage-700 mb-4">Module Title</h2>
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-sage-500 mb-6">
                <p id="mod-content" class="text-lg font-medium text-gray-800 leading-relaxed">Content...</p>
            </div>
            <div id="journal-area" class="hidden mb-4">
                <textarea id="journal-input" rows="10" class="w-full p-4 bg-white border border-sage-200 rounded-lg text-base focus:ring-2 focus:ring-sage-500 outline-none shadow-inner" placeholder="Reflect here..."></textarea>
            </div>
            <button onclick="saveModuleToVault()" class="w-full bg-sage-500 text-white font-bold py-3 rounded-xl shadow-lg mb-3">Save to Vault</button>
            <button onclick="navigateTo('screen-report')" class="w-full text-gray-400 text-sm text-center">Back to Result</button>
        </div>

        <div id="screen-vault" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-sage-700">The Vault</h2>
                <button onclick="navigateTo('screen-home')" class="text-sm text-gray-400">Back</button>
            </div>
            <div id="vault-list" class="space-y-4 pb-20"></div>
        </div>

        <div id="screen-about" class="hidden fade-in">
            <h2 class="text-xl font-bold text-sage-700 mb-4">About Pattern Breaker</h2>
            <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <p class="text-sm text-gray-600 leading-relaxed mb-4">
                    Pattern Breaker is designed to help you understand your emotional responses to abandonment triggers.
                </p>
                <div class="mt-4 border-t pt-4">
                    <p class="font-bold text-sage-700 mb-2">Want to go deeper?</p>
                    <p class="text-sm text-gray-600 mb-4">The app is your emergency kit. The course is the cure.</p>
                    <a href="https://angel-s-site-4148.thinkific.com/courses/understanding-relationship-patterns" target="_blank" class="block bg-sage-500 text-white text-center py-2 rounded-lg font-bold hover:bg-sage-600 transition">View Full Course</a>
                </div>
            </div>
            <button onclick="navigateTo('screen-home')" class="w-full text-center text-gray-400 text-xs mt-4">Back</button>
        </div>

    </main>

    <div id="toast">Action Saved</div>

    <div id="paywallModal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 text-center">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Unlock the Vault</h2>
            <p class="text-gray-600 mb-6 text-sm">Save your entries and access journaling. Included for course students.</p>
            <a href="https://buy.stripe.com/4gM5kDfQX6uj2Ghb829fW00" target="_blank" class="block w-full bg-sage-500 text-white font-bold py-3 rounded-lg mb-4 hover:bg-sage-600">Subscribe for $5/mo</a>
            <div class="flex gap-2">
                <input type="text" id="accessCode" placeholder="STUDENT CODE" class="flex-grow border border-gray-300 rounded p-2 text-sm uppercase">
                <button onclick="checkCode()" class="bg-gray-800 text-white px-4 rounded text-sm">Unlock</button>
            </div>
            <button onclick="closePaywall()" class="mt-4 text-xs text-gray-400 underline">Close</button>
        </div>
    </div>

    <script>
        const appState = {
            isPremium: localStorage.getItem('lunaPremium') === 'true',
            patternInput: { ventText: "", supportArea: null, intensity: 5, firstBehavior: null },
            decoderResult: null,
            activeModule: null
        };

        const LOGIC_DB = {
            'hyper_independence': {
                name: "Hyper Independence",
                subtype: "Protection Mode",
                what: "You are pushing others away to maintain control. Your system registers 'needing' as 'unsafe'.",
                why: "Early on, you learned no one was coming to save you. Aloneness feels like the only safety.",
                interrupt: "Drop your shoulders. Unclench your jaw. Say out loud: 'It is safe to let people in, just a little.'",
                practice: "The 5% Rule: Ask for help with one tiny thing today.",
                anchor: "I do not have to carry it all to be safe.",
                prompt: "What am I afraid will happen if I admit I need support right now?"
            },
            'panic_clinging': {
                name: "Anxious Grasping",
                subtype: "Fight Mode Activation",
                what: "Your nervous system is screaming. You feel an urgent need to 'fix' the connection immediately.",
                why: "An attachment wound is being touched. Your body is mobilizing energy to bridge the gap.",
                interrupt: "Put the phone down. Push your hands hard against a wall for 10 seconds.",
                practice: "Self-Soothing: Place a hand on your chest and say 'I am here with you.'",
                anchor: "My safety is inside me, not in their response.",
                prompt: "What am I trying to earn from them that I can give to myself right now?"
            },
            'shutdown': {
                name: "Emotional Shutdown",
                subtype: "Freeze/Collapse Mode",
                what: "You are going numb. You feel foggy, distant, or 'checked out'.",
                why: "This is a learned survival strategy to survive overwhelming pain. You are protecting your core.",
                interrupt: "Shake your hands vigorously. Wrap yourself tightly in a heavy blanket.",
                practice: "Orientation: Name 3 colors you see in the room out loud.",
                anchor: "It is safe to be in my body.",
                prompt: "What feeling am I numbing out to avoid?"
            },
            'over_explaining': {
                name: "Over-Explaining",
                subtype: "Fawn/Appeasement",
                what: "You are over-talking to manage the other person's emotions.",
                why: "You learned your needs were 'too much'. You survived by being easy and manageable.",
                interrupt: "Stop talking. Take a breath. Say: 'I've said enough.'",
                practice: "The Pause: Count to 5 before responding to anything today.",
                anchor: "I do not need to explain my existence.",
                prompt: "Where am I shrinking myself to make someone else comfortable?"
            },
            'over_giving': {
                name: "Over Giving",
                subtype: "Fawn/Appeasement",
                what: "You are pouring out energy to ensure you are 'needed.'",
                why: "You learned that love was conditional on your utility. If you stop giving, you fear you become disposable.",
                interrupt: "Clench your fists, then release. Ask: 'Do I actually want to do this?'",
                practice: "Say 'No' to one small thing today.",
                anchor: "My value is not in what I provide.",
                prompt: "What am I trying to buy with my generosity?"
            },
            'distrust': {
                name: "Hyper-Vigilance",
                subtype: "Scan Mode",
                what: "You are waiting for the other shoe to drop. You are analyzing tone and timing.",
                why: "Chaos feels familiar; stability feels suspicious. Your nervous system is wired to scan for danger.",
                interrupt: "Look around the room. Find safety cues. Fact-check: What is real vs imagined?",
                practice: "Reality Testing: Write down the facts vs. the story.",
                anchor: "I can trust myself to handle whatever happens.",
                prompt: "What story am I inventing to prepare for pain?"
            },
            'self_blame': {
                name: "Internalized Blame",
                subtype: "Fawn/Freeze Mixed",
                what: "You are taking 100% of the responsibility. You are turning the anger inward.",
                why: "It felt safer to believe 'I am bad' (fixable) than 'They are unsafe' (terrifying).",
                interrupt: "Say: 'This is not all my fault.' Push your feet into the floor.",
                practice: "Compassion: Talk to yourself like a friend.",
                anchor: "I am not the problem.",
                prompt: "What responsibility am I carrying that isn't mine?"
            }
        };

        function updateState(key, value) { appState.patternInput[key] = value; }

        function navigateTo(screenId) {
            const map = {
                'screen-home': { id: 'screen-home', progress: '33%' },
                'screen-safety': { id: 'screen-safety', progress: '66%' },
                'screen-intake': { id: 'screen-intake', progress: '100%' },
                'screen-report': { id: 'screen-report', progress: '100%' },
                'screen-module': { id: 'screen-module', progress: '100%' },
                'screen-vault': { id: 'screen-vault', progress: '0%' },
                'screen-about': { id: 'screen-about', progress: '0%' }
            };

            const target = map[screenId];
            if(!target) return;

            Object.values(map).forEach(s => document.getElementById(s.id).classList.add('hidden'));
            document.getElementById(target.id).classList.remove('hidden');
            
            const bar = document.getElementById('progress-container');
            const fill = document.getElementById('progress-fill');
            if (target.progress === '0%' || target.progress === '33%') bar.classList.add('hidden');
            else {
                bar.classList.remove('hidden');
                setTimeout(() => fill.style.width = target.progress, 50);
            }

            if(screenId === 'screen-vault') renderVault();
        }

        function resetFlow() {
            appState.patternInput = { ventText: "", supportArea: null, intensity: 5, firstBehavior: null };
            document.getElementById('intake-vent').value = "";
            document.getElementById('intake-goal').value = "";
            document.getElementById('behavior-select').value = "";
            navigateTo('screen-home');
        }

        function runDecoder() {
            const behavior = appState.patternInput.firstBehavior;
            if(!behavior) return alert("Please select a behavior.");

            document.getElementById('decode-btn-text').innerText = "Analyzing...";
            document.getElementById('decode-spinner').classList.remove('hidden');

            setTimeout(() => {
                const data = LOGIC_DB[behavior] || LOGIC_DB['panic_clinging'];
                
                appState.decoderResult = {
                    pattern: data.name,
                    subtype: data.subtype,
                    intensity: appState.patternInput.intensity,
                    what: data.what,
                    why: data.why,
                    interrupt: data.interrupt,
                    practice: data.practice,
                    anchor: data.anchor,
                    prompt: data.prompt
                };

                document.getElementById('out-pattern').innerText = data.name;
                document.getElementById('out-subtype').innerText = `Intensity Level: ${appState.patternInput.intensity}/10`;
                document.getElementById('out-what').innerText = data.what;
                document.getElementById('out-why').innerText = data.why;

                document.getElementById('decode-btn-text').innerText = "Decode My Pattern";
                document.getElementById('decode-spinner').classList.add('hidden');
                
                navigateTo('screen-report');
            }, 800);
        }

        function showModule(moduleName) {
            if (moduleName === 'Journal Prompt' && !appState.isPremium) return showPaywall();

            appState.activeModule = moduleName;
            document.getElementById('mod-title').innerText = moduleName;
            
            let content = "";
            const res = appState.decoderResult;
            
            if (moduleName === "Pattern Interrupter") content = res.interrupt;
            else if (moduleName === "Daily Practice") content = res.practice;
            else if (moduleName === "Anchor for Today") content = `"${res.anchor}"`;
            else if (moduleName === "Journal Prompt") content = res.prompt;

            document.getElementById('mod-content').innerText = content;

            const journalArea = document.getElementById('journal-area');
            if (moduleName === 'Journal Prompt') {
                journalArea.classList.remove('hidden');
                const vent = appState.patternInput.ventText || "";
                document.getElementById('journal-input').value = vent ? `[My initial thought]: ${vent}\n\n` : ""; 
            } else {
                journalArea.classList.add('hidden');
            }

            navigateTo('screen-module');
        }

        function saveModuleToVault() {
            if(!appState.isPremium) return showPaywall();
            let content = document.getElementById('mod-content').innerText;
            if (appState.activeModule === 'Journal Prompt') {
                const written = document.getElementById('journal-input').value;
                if(!written) return alert("Please write an entry.");
                content += "\n\n" + written;
            }
            saveToVault(appState.activeModule, content);
        }

        function saveResultToVault() {
            if(!appState.isPremium) return showPaywall();
            saveToVault("Pattern Result", `${appState.decoderResult.pattern}: ${appState.decoderResult.what}`);
        }

        function saveToVault(type, content) {
            const entry = {
                date: new Date(),
                pattern: appState.decoderResult.pattern,
                intensity: appState.decoderResult.intensity,
                type: type,
                content: content
            };
            const vault = JSON.parse(localStorage.getItem('lunaVault') || '[]');
            vault.unshift(entry);
            localStorage.setItem('lunaVault', JSON.stringify(vault));
            showToast("Saved to Vault");
            if (type !== 'Pattern Result') navigateTo('screen-report');
        }

        function renderVault() {
            const vault = JSON.parse(localStorage.getItem('lunaVault') || '[]');
            const list = document.getElementById('vault-list');
            if(vault.length === 0) return list.innerHTML = '<p class="text-center text-gray-400 mt-10">No entries yet.</p>';
            list.innerHTML = vault.map(e => `
                <div class="bg-white p-4 rounded-xl shadow border-l-4 border-sage-500">
                    <div class="flex justify-between mb-2">
                        <span class="font-bold text-gray-800">${e.pattern}</span>
                        <span class="text-xs text-gray-400">${new Date(e.date).toLocaleDateString()}</span>
                    </div>
                    <p class="text-xs font-bold text-sage-500 uppercase mb-1">${e.type} (Level ${e.intensity})</p>
                    <p class="text-sm text-gray-800 whitespace-pre-wrap">${e.content}</p>
                </div>
            `).join('');
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
        }

        function showPaywall() { document.getElementById('paywallModal').classList.remove('hidden'); }
        function closePaywall() { document.getElementById('paywallModal').classList.add('hidden'); }
        function checkCode() {
            if (document.getElementById('accessCode').value.toUpperCase() === 'LUNA2025') {
                appState.isPremium = true; localStorage.setItem('lunaPremium', 'true'); alert("Unlocked!"); closePaywall(); document.getElementById('upgradeBtn').classList.add('hidden');
            } else { alert("Incorrect Code"); }
        }

        if(appState.isPremium) document.getElementById('upgradeBtn').classList.add('hidden');
        navigateTo('screen-home');
    </script>
</body>
</html>